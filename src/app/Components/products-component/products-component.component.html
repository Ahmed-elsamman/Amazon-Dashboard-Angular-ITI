<div class="container mt-4">
  <h1 class="text-center mb-4 text-primary font-weight-bold bg-dark text-white">
    Products
  </h1>
  <!-- Add Product Button -->

  <button
    mat-raised-button
    color="primary"
    (click)="openCreateProductModal()"
    class="mb-4"
  >
    Add New Product
  </button>
  <div class="search-container">
    <mat-form-field class="search-input" appearance="outline">
      <mat-label>Search Users</mat-label>
      <input matInput (keyup)="filterProductsToSearch($event)" #input />
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>
  </div>

  <!-- Add Product Button -->

  <h2 class="mb-2 text-center">Products List</h2>

  <!-- تحديث قسم الجدول ليكون مستجيب -->
  <div class="table-responsive-container">
    <table
      mat-table
      [dataSource]="products"
      class="table table-striped table-bordered"
    >
      <!-- Image Column -->
      <ng-container matColumnDef="image">
        <th mat-header-cell *matHeaderCellDef>Image</th>
        <td mat-cell *matCellDef="let product">
          <img
            [src]="product.imageUrls[0]"
            alt="{{ product.name.en }}"
            class="product-image img-fluid"
          />
        </td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let product">{{ product.name.en }}</td>
      </ng-container>

      <!-- Price Column -->
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef>Price</th>
        <td mat-cell *matCellDef="let product">
          {{ product.price | currency }}
        </td>
      </ng-container>

      <!-- Brand Column -->
      <ng-container matColumnDef="brand">
        <th mat-header-cell *matHeaderCellDef>Brand</th>
        <td mat-cell *matCellDef="let product">{{ product.brand }}</td>
      </ng-container>

      <!-- Stock Column -->
      <ng-container matColumnDef="stock">
        <th mat-header-cell *matHeaderCellDef>Stock</th>
        <td mat-cell *matCellDef="let product">{{ product.stock }}</td>
      </ng-container>

      <!-- CreatedAt Column -->
      <ng-container matColumnDef="createdAt">
        <th mat-header-cell *matHeaderCellDef>Created At</th>
        <td mat-cell *matCellDef="let product">
          {{ product.createdAt | date : "short" }}
        </td>
      </ng-container>

      <!-- UpdatedAt Column -->
      <ng-container matColumnDef="updatedAt">
        <th mat-header-cell *matHeaderCellDef>Updated At</th>
        <td mat-cell *matCellDef="let product">
          {{ product.updatedAt | date : "short" }}
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let product">
          <button mat-icon-button (click)="openEditModal(product)" title="Edit">
            <mat-icon>edit</mat-icon>
          </button>
          <button
            mat-icon-button
            (click)="deleteProduct(product._id)"
            title="Delete"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>

  <!-- Pagination Component -->
  <mat-paginator
    [length]="totalCount"
    [pageSize]="limit"
    [pageSizeOptions]="[5, 10, 20]"
    (page)="onPageChange($event)"
    aria-label="Select page"
  >
  </mat-paginator>

  <!-- تحديث قسم الرسوم البيانية -->
  <div class="charts-container">
    <div class="chart-wrapper">
      <h3 class="chart-title">توزيع المنتجات حسب العلامة التجارية</h3>
      <ngx-charts-bar-vertical
        [view]="[width, width > 768 ? 300 : 200]"
        [results]="brandChartData"
        [scheme]="'cool'"
        [gradient]="true"
        [xAxis]="showXAxis"
        [yAxis]="showYAxis"
        [legend]="width > 480"
        [showXAxisLabel]="showXAxisLabel"
        [showYAxisLabel]="showYAxisLabel"
        [xAxisLabel]="xAxisLabel"
        [yAxisLabel]="'النسبة المئوية (%)'"
        (window:resize)="onResize($event)"
        [animations]="true"
      >
      </ngx-charts-bar-vertical>
    </div>

    <div class="chart-wrapper">
      <h3 class="chart-title">توزيع المنتجات حسب البائعين</h3>
      <ngx-charts-bar-horizontal
        [view]="[width, width > 768 ? 300 : 200]"
        [results]="sellerChartData"
        [scheme]="'cool'"
        [gradient]="true"
        [xAxis]="showXAxis"
        [yAxis]="showYAxis"
        [legend]="width > 480"
        [showXAxisLabel]="showXAxisLabel"
        [showYAxisLabel]="showYAxisLabel"
        [xAxisLabel]="'النسبة المئوية (%)'"
        [yAxisLabel]="'البائع'"
        (window:resize)="onResize($event)"
        [animations]="true"
      >
      </ngx-charts-bar-horizontal>
    </div>
  </div>
</div>
