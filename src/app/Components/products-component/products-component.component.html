<div class="container mt-4">
  <h1 class="text-center mb-4 text-primary font-weight-bold bg-dark text-white">
    Products
  </h1>
  <!-- Add Product Button -->
  <!-- Unverified Products Section -->
  <div
    class="unverified-products-section"
    *ngIf="unverifiedProducts.length > 0"
  >
    <h2 class="section-title">Unverified Products</h2>
    <div class="unverified-products-container">
      <div
        class="unverified-product-card"
        *ngFor="let product of unverifiedProducts"
      >
        <img
          [src]="product.imageUrls[0]"
          [alt]="product.name.en"
          class="unverified-product-image"
        />
        <div class="unverified-product-details">
          <h3>{{ product.name.en }}</h3>
          <p class="brand">{{ product.brand }}</p>
          <p class="price">{{ product.price | currency }}</p>
          <p class="stock">{{ product.stock }}</p>
          <div class="actions">
            <button
              mat-raised-button
              color="primary"
              (click)="openEditModal(product)"
            >
              <mat-icon>edit</mat-icon> Edit
            </button>
            <button
              mat-raised-button
              color="warn"
              (click)="deleteProduct(product._id)"
            >
              <mat-icon>delete</mat-icon> Delete
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <button
    mat-raised-button
    color="primary"
    (click)="openCreateProductModal()"
    class="mb-4"
  >
    Add New Product
  </button>
  <div class="search-container">
    <mat-form-field class="search-input" appearance="outline">
      <mat-label>Search Users</mat-label>
      <input matInput (keyup)="filterProductsToSearch($event)" #input />
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>
  </div>

  <!-- Add Product Button -->

  <!-- تحديث قسم الجدول ليكون مستجيب -->
  <div class="table-responsive-container">
    <table
      mat-table
      [dataSource]="products"
      class="table table-striped table-bordered"
    >
      <!-- Image Column -->
      <ng-container matColumnDef="image">
        <th mat-header-cell *matHeaderCellDef>Image</th>
        <td mat-cell *matCellDef="let product">
          <img
            [src]="product.imageUrls[0]"
            alt="{{ product.name.en }}"
            class="product-image img-fluid"
          />
        </td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let product">{{ product.name.en }}</td>
      </ng-container>

      <!-- Price Column -->
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef>Price</th>
        <td mat-cell *matCellDef="let product">
          {{ product.price | currency }}
        </td>
      </ng-container>

      <!-- Brand Column -->
      <ng-container matColumnDef="brand">
        <th mat-header-cell *matHeaderCellDef>Brand</th>
        <td mat-cell *matCellDef="let product">{{ product.brand }}</td>
      </ng-container>

      <!-- Stock Column -->
      <ng-container matColumnDef="stock">
        <th mat-header-cell *matHeaderCellDef>Stock</th>
        <td mat-cell *matCellDef="let product">{{ product.stock }}</td>
      </ng-container>

      <!-- isVerified Column -->
      <ng-container matColumnDef="isVerified">
        <th mat-header-cell *matHeaderCellDef>Verification Status</th>
        <td mat-cell *matCellDef="let product">
          <span
            [ngClass]="{
              verified: product.isVerified,
              'not-verified': !product.isVerified
            }"
          >
            {{ product.isVerified ? "Verified" : "Not Verified" }}
          </span>
        </td>
      </ng-container>

      <!-- CreatedAt Column -->
      <ng-container matColumnDef="createdAt">
        <th mat-header-cell *matHeaderCellDef>Created At</th>
        <td mat-cell *matCellDef="let product">
          {{ product.createdAt | date : "short" }}
        </td>
      </ng-container>

      <!-- UpdatedAt Column -->
      <ng-container matColumnDef="updatedAt">
        <th mat-header-cell *matHeaderCellDef>Updated At</th>
        <td mat-cell *matCellDef="let product">
          {{ product.updatedAt | date : "short" }}
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let product">
          <button mat-icon-button (click)="openEditModal(product)" title="Edit">
            <mat-icon>edit</mat-icon>
          </button>
          <button
            mat-icon-button
            (click)="deleteProduct(product._id)"
            title="Delete"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>

  <!-- Pagination Component -->
  <mat-paginator
    [length]="totalCount"
    [pageSize]="limit"
    [pageSizeOptions]="[5, 10, 20]"
    (page)="onPageChange($event)"
    aria-label="Select page"
  >
  </mat-paginator>

  <!-- Update Charts Section -->
  <div class="charts-container">
    <div class="chart-wrapper">
      <h3 class="chart-title">Products Distribution by Brand</h3>
      <ngx-charts-bar-vertical
        [view]="[width, width > 768 ? 300 : 200]"
        [results]="brandChartData"
        [scheme]="'cool'"
        [gradient]="true"
        [xAxis]="showXAxis"
        [yAxis]="showYAxis"
        [legend]="width > 480"
        [showXAxisLabel]="showXAxisLabel"
        [showYAxisLabel]="showYAxisLabel"
        [xAxisLabel]="xAxisLabel"
        [yAxisLabel]="'Percentage (%)'"
        (window:resize)="onResize($event)"
        [animations]="true"
      >
      </ngx-charts-bar-vertical>
    </div>

    <div class="chart-wrapper">
      <h3 class="chart-title">Products Distribution by Sellers</h3>
      <ngx-charts-bar-horizontal
        [view]="[width, width > 768 ? 300 : 200]"
        [results]="sellerChartData"
        [scheme]="'cool'"
        [gradient]="true"
        [xAxis]="showXAxis"
        [yAxis]="showYAxis"
        [legend]="width > 480"
        [showXAxisLabel]="showXAxisLabel"
        [showYAxisLabel]="showYAxisLabel"
        [xAxisLabel]="'Percentage (%)'"
        [yAxisLabel]="'Seller'"
        (window:resize)="onResize($event)"
        [animations]="true"
      >
      </ngx-charts-bar-horizontal>
    </div>
  </div>
</div>
